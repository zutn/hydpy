
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>hydpy.core.exceptiontools &#8212; HydPy 2.1-dev documentation</title>
    <link rel="stylesheet" href="../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">HydPy 2.1-dev documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for hydpy.core.exceptiontools</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;This module implements some exception classes and related features.&quot;&quot;&quot;</span>

<span class="c1"># import...</span>
<span class="c1"># ...from site-packages</span>
<span class="kn">import</span> <span class="nn">wrapt</span>
<span class="c1"># ...from HydPy</span>
<span class="kn">from</span> <span class="nn">hydpy</span> <span class="k">import</span> <span class="n">pub</span>
<span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="k">import</span> <span class="n">autodoctools</span>
<span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="k">import</span> <span class="n">objecttools</span>


<div class="viewcode-block" id="AttributeNotReady"><a class="viewcode-back" href="../../../exceptiontools.html#hydpy.core.exceptiontools.AttributeNotReady">[docs]</a><span class="k">class</span> <span class="nc">AttributeNotReady</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The attribute is principally defined, but must be prepared first.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="IsReady"><a class="viewcode-back" href="../../../exceptiontools.html#hydpy.core.exceptiontools.IsReady">[docs]</a><span class="k">class</span> <span class="nc">IsReady</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Container that informs, whether all variables required in a certain</span>
<span class="sd">    context are properly prepared or not.</span>

<span class="sd">    All variables can start with a `True` or `False` value:</span>

<span class="sd">    &gt;&gt;&gt; from hydpy.core.exceptiontools import IsReady</span>
<span class="sd">    &gt;&gt;&gt; isready = IsReady(true=[&#39;x&#39;, &#39;y&#39;], false=[&#39;z&#39;])</span>
<span class="sd">    &gt;&gt;&gt; isready.x</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; isready.z</span>
<span class="sd">    False</span>

<span class="sd">    If there is at least one `False` value, the |IsReady| object itself</span>
<span class="sd">    is considered to be `False`:</span>

<span class="sd">    &gt;&gt;&gt; isready</span>
<span class="sd">    IsReady(true=[&#39;x&#39;, &#39;y&#39;],</span>
<span class="sd">            false=[&#39;z&#39;])</span>
<span class="sd">    &gt;&gt;&gt; bool(isready)</span>
<span class="sd">    False</span>

<span class="sd">    Only in case all values are `True`, `isready` is considered to the</span>
<span class="sd">    `True`:</span>

<span class="sd">    &gt;&gt;&gt; isready.z = True</span>
<span class="sd">    &gt;&gt;&gt; isready</span>
<span class="sd">    IsReady(true=[&#39;x&#39;, &#39;y&#39;, &#39;z&#39;],</span>
<span class="sd">            false=[])</span>
<span class="sd">    &gt;&gt;&gt; bool(isready)</span>
<span class="sd">    True</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">true</span><span class="o">=</span><span class="p">(),</span> <span class="n">false</span><span class="o">=</span><span class="p">()):</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">true</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">false</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">true</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sorted tuple of the names of all `True` variables.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.core.exceptiontools import IsReady</span>
<span class="sd">        &gt;&gt;&gt; isready = IsReady(true=[&#39;b&#39;, &#39;c&#39;, &#39;a&#39;], false=[&#39;z&#39;])</span>
<span class="sd">        &gt;&gt;&gt; isready.true</span>
<span class="sd">        (&#39;a&#39;, &#39;b&#39;, &#39;c&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">name</span> <span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="n">value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">false</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sorted tuple of the names of all `False` variables.</span>

<span class="sd">        &gt;&gt;&gt; from hydpy.core.exceptiontools import IsReady</span>
<span class="sd">        &gt;&gt;&gt; isready = IsReady(false=[&#39;b&#39;, &#39;c&#39;, &#39;a&#39;], true=[&#39;z&#39;])</span>
<span class="sd">        &gt;&gt;&gt; isready.false</span>
<span class="sd">        (&#39;a&#39;, &#39;b&#39;, &#39;c&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">name</span> <span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__bool__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">__nonzero__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>   <span class="c1"># pragma: no cover</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__bool__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="k">yield</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">true</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">true</span><span class="p">]</span>
        <span class="n">false</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">false</span><span class="p">]</span>
        <span class="n">arl</span> <span class="o">=</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">assignrepr_list</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">arl</span><span class="p">(</span><span class="n">true</span><span class="p">,</span> <span class="s1">&#39;IsReady(true=&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">70</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
                <span class="n">arl</span><span class="p">(</span><span class="n">false</span><span class="p">,</span> <span class="s1">&#39;        false=&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">70</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">_objectname</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">instancename</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>


<div class="viewcode-block" id="protected_property"><a class="viewcode-back" href="../../../exceptiontools.html#hydpy.core.exceptiontools.protected_property">[docs]</a><span class="k">def</span> <span class="nf">protected_property</span><span class="p">(</span><span class="n">propname</span><span class="p">,</span> <span class="n">fget</span><span class="p">,</span> <span class="n">fset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fdel</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return a |property| which prevents getting an attribute</span>
<span class="sd">    before setting it.</span>

<span class="sd">    Under some circumstances, an attribute value needs to be prepared</span>
<span class="sd">    before one should be allowed to query it.  Consider the case where</span>
<span class="sd">    a property of a Python class (beeing part of the API) links to an</span>
<span class="sd">    attribute of a Cython extension class (not part of the API).  If</span>
<span class="sd">    the Cython attribute is e.g. some type of vector requiring memory</span>
<span class="sd">    allocation, trying to query this vector befor it has actually been</span>
<span class="sd">    prepared results in a programm crash.  Using |protected_property|</span>
<span class="sd">    is a means to prevent from such problems to occur.</span>

<span class="sd">    Consider the following class `Test`, which defines most simple</span>
<span class="sd">    `set`, `get`, and `del` methods for its only property `x`:</span>

<span class="sd">    &gt;&gt;&gt; from hydpy.core.exceptiontools import IsReady, protected_property</span>
<span class="sd">    &gt;&gt;&gt; class Test(object):</span>
<span class="sd">    ...</span>
<span class="sd">    ...     def __init__(self):</span>
<span class="sd">    ...         self._x = None</span>
<span class="sd">    ...         self._isready = IsReady(false=[&#39;x&#39;])</span>
<span class="sd">    ...</span>
<span class="sd">    ...     def _get_x(self):</span>
<span class="sd">    ...         return self._x</span>
<span class="sd">    ...</span>
<span class="sd">    ...     def _set_x(self, value):</span>
<span class="sd">    ...         self._x = value</span>
<span class="sd">    ...</span>
<span class="sd">    ...     def _del_x(self):</span>
<span class="sd">    ...         self._x = None</span>
<span class="sd">    ...</span>
<span class="sd">    ...     x = protected_property(</span>
<span class="sd">    ...         &#39;x&#39;, _get_x, _set_x, _del_x)</span>

<span class="sd">    Due to using |protected_property| instead of |property|, trying</span>
<span class="sd">    to query `x` after initializing a `Test` object results in an</span>
<span class="sd">    |AttributeNotReady| error:</span>

<span class="sd">    &gt;&gt;&gt; test = Test()</span>
<span class="sd">    &gt;&gt;&gt; test.x</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    AttributeNotReady: Attribute `x` of object `test` has not been \</span>
<span class="sd">prepared so far.</span>

<span class="sd">    After setting a value for property `x`, this value can be queried</span>
<span class="sd">    as expected:</span>

<span class="sd">    &gt;&gt;&gt; test.x = 1</span>
<span class="sd">    &gt;&gt;&gt; test.x</span>
<span class="sd">    1</span>

<span class="sd">    After deleting `x`, its valu is not accessible, again:</span>

<span class="sd">    &gt;&gt;&gt; del test.x</span>
<span class="sd">    &gt;&gt;&gt; test.x</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    AttributeNotReady: Attribute `x` of object `test` has not been \</span>
<span class="sd">prepared so far.</span>

<span class="sd">    If the considered object defines a name (different from the class</span>
<span class="sd">    name in lower letters) and/or references a |Node| or |Element|</span>
<span class="sd">    object, the exception message includes this additional information:</span>

<span class="sd">    &gt;&gt;&gt; from hydpy import Element</span>
<span class="sd">    &gt;&gt;&gt; test.name = &#39;name_object&#39;</span>
<span class="sd">    &gt;&gt;&gt; test.element = Element(&#39;name_element&#39;)</span>

<span class="sd">    &gt;&gt;&gt; test.x</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    AttributeNotReady: Attribute `x` of object `name_object` of \</span>
<span class="sd">element `name_element` has not been prepared so far.</span>

<span class="sd">    As for |property|, the `set` and `del` can be omitted.  As an</span>
<span class="sd">    example, we redefine class `Test` with a `get` method only:</span>

<span class="sd">    &gt;&gt;&gt; class Test(object):</span>
<span class="sd">    ...</span>
<span class="sd">    ...     def __init__(self):</span>
<span class="sd">    ...         self._x = None</span>
<span class="sd">    ...         self._isready = IsReady(false=[&#39;x&#39;])</span>
<span class="sd">    ...</span>
<span class="sd">    ...     def _get_x(self):</span>
<span class="sd">    ...         return self._x</span>
<span class="sd">    ...</span>
<span class="sd">    ...     x = protected_property(</span>
<span class="sd">    ...         &#39;x&#39;, _get_x)</span>
<span class="sd">    &gt;&gt;&gt; test = Test()</span>

<span class="sd">    Now trying to set a new value results in the usual error...</span>

<span class="sd">    &gt;&gt;&gt; test.x = 1</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    AttributeError: cannot set attribute</span>

<span class="sd">    ...and does not change the value of attribute `x`:</span>

<span class="sd">    &gt;&gt;&gt; test.x</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    AttributeNotReady: Attribute `x` of object `test` has not been \</span>
<span class="sd">prepared so far.</span>

<span class="sd">    The same holds true for trying to delete the value of attribute `x`:</span>

<span class="sd">    &gt;&gt;&gt; del test.x</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    AttributeError: cannot delete attribute</span>

<span class="sd">    .. note::</span>

<span class="sd">        The class making use of |protected_property| must implement</span>
<span class="sd">        an |IsReady| member as shown in the example.  The member name</span>
<span class="sd">        `_isready` is mandatory.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># pylint: disable=no-value-for-parameter, unused-argument, protected-access</span>
    <span class="nd">@wrapt</span><span class="o">.</span><span class="n">decorator</span>
    <span class="k">def</span> <span class="nf">wrap_fget</span><span class="p">(</span><span class="n">wrapped</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Wrap the get function.&quot;&quot;&quot;</span>
        <span class="bp">self</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_isready</span><span class="p">,</span> <span class="n">propname</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">AttributeNotReady</span><span class="p">(</span>
                <span class="s1">&#39;Attribute `</span><span class="si">%s</span><span class="s1">` of object `</span><span class="si">%s</span><span class="s1">`</span><span class="si">%s</span><span class="s1">has not been prepared so far.&#39;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">propname</span><span class="p">,</span>
                   <span class="n">_objectname</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
                   <span class="n">objecttools</span><span class="o">.</span><span class="n">devicephrase</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span>

    <span class="nd">@wrapt</span><span class="o">.</span><span class="n">decorator</span>
    <span class="k">def</span> <span class="nf">wrap_fset</span><span class="p">(</span><span class="n">wrapped</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Wrap the set function.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">wrapped</span><span class="p">:</span>
            <span class="n">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_isready</span><span class="p">,</span> <span class="n">propname</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                <span class="s1">&#39;cannot set attribute&#39;</span><span class="p">)</span>

    <span class="nd">@wrapt</span><span class="o">.</span><span class="n">decorator</span>
    <span class="k">def</span> <span class="nf">wrap_fdel</span><span class="p">(</span><span class="n">wrapped</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Wrap the del function.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">wrapped</span><span class="p">:</span>
            <span class="n">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_isready</span><span class="p">,</span> <span class="n">propname</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                <span class="s1">&#39;cannot delete attribute&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="nb">property</span><span class="p">(</span><span class="n">wrap_fget</span><span class="p">(</span><span class="n">fget</span><span class="p">),</span> <span class="n">wrap_fset</span><span class="p">(</span><span class="n">fset</span><span class="p">),</span> <span class="n">wrap_fdel</span><span class="p">(</span><span class="n">fdel</span><span class="p">))</span></div>


<div class="viewcode-block" id="dependent_property"><a class="viewcode-back" href="../../../exceptiontools.html#hydpy.core.exceptiontools.dependent_property">[docs]</a><span class="k">def</span> <span class="nf">dependent_property</span><span class="p">(</span><span class="n">propname</span><span class="p">,</span> <span class="n">fget</span><span class="p">,</span> <span class="n">fset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fdel</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return a |property| which prevents accessing a dependent attribute</span>
<span class="sd">    before other attributes have been prepared.</span>

<span class="sd">    The following explanations suppose first reading the documentation</span>
<span class="sd">    on function |protected_property|.  Here the example class `Test` is</span>
<span class="sd">    defined very similarly, but `x` is returned by |dependent_property|</span>
<span class="sd">    instead of |protected_property|, and the |IsReady| member knows</span>
<span class="sd">    another attribute `y` but not the dependent attribute `x` (usually</span>
<span class="sd">    but not mandatory, `y` itself would be implemented as a</span>
<span class="sd">    |protected_property|, which is left out for reasons of brevity):</span>

<span class="sd">    &gt;&gt;&gt; from hydpy.core.exceptiontools import IsReady, protected_property</span>
<span class="sd">    &gt;&gt;&gt; from hydpy.core.exceptiontools import dependent_property</span>
<span class="sd">    &gt;&gt;&gt; class Test(object):</span>
<span class="sd">    ...</span>
<span class="sd">    ...     def __init__(self):</span>
<span class="sd">    ...         self._x = None</span>
<span class="sd">    ...         self._isready = IsReady(false=[&#39;y&#39;])</span>
<span class="sd">    ...</span>
<span class="sd">    ...     def _get_x(self):</span>
<span class="sd">    ...         return self._x</span>
<span class="sd">    ...</span>
<span class="sd">    ...     def _set_x(self, value):</span>
<span class="sd">    ...         self._x = value</span>
<span class="sd">    ...</span>
<span class="sd">    ...     def _del_x(self):</span>
<span class="sd">    ...         self._x = None</span>
<span class="sd">    ...</span>
<span class="sd">    ...     x = dependent_property(</span>
<span class="sd">    ...         &#39;x&#39;, _get_x, _set_x, _del_x)</span>

<span class="sd">    Initially, due to `y` beeing not prepared according to `_isready`,</span>
<span class="sd">    there is no way to get, set, or delete attribute `x`:</span>

<span class="sd">    &gt;&gt;&gt; test = Test()</span>
<span class="sd">    &gt;&gt;&gt; test.x</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    AttributeNotReady: Attribute `x` of object `test` is not usable so far.</span>

<span class="sd">    &gt;&gt;&gt; test.x = 1</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    AttributeNotReady: Attribute `x` of object `test` is not usable so far.</span>

<span class="sd">    &gt;&gt;&gt; del test.x</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    AttributeNotReady: Attribute `x` of object `test` is not usable so far.</span>

<span class="sd">    However, after setting the `y` flag to `True`, `x` behaves like a</span>
<span class="sd">    &quot;normal&quot; property:</span>

<span class="sd">    &gt;&gt;&gt; test._isready.y = True</span>
<span class="sd">    &gt;&gt;&gt; test.x = 1</span>
<span class="sd">    &gt;&gt;&gt; test.x</span>
<span class="sd">    1</span>
<span class="sd">    &gt;&gt;&gt; del test.x</span>
<span class="sd">    &gt;&gt;&gt; test.x</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># pylint: disable=no-value-for-parameter, unused-argument</span>
    <span class="nd">@wrapt</span><span class="o">.</span><span class="n">decorator</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="n">wrapped</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Wrap the get, set, or del method.&quot;&quot;&quot;</span>
        <span class="bp">self</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">wrapped</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                <span class="s1">&#39;Attribute `</span><span class="si">%s</span><span class="s1">` of object `</span><span class="si">%s</span><span class="s1">`</span><span class="si">%s</span><span class="s1">cannot be used this way.&#39;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">propname</span><span class="p">,</span>
                   <span class="n">_objectname</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
                   <span class="n">objecttools</span><span class="o">.</span><span class="n">devicephrase</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isready</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">AttributeNotReady</span><span class="p">(</span>
                <span class="s1">&#39;Attribute `</span><span class="si">%s</span><span class="s1">` of object `</span><span class="si">%s</span><span class="s1">`</span><span class="si">%s</span><span class="s1">is not usable so far.&#39;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">propname</span><span class="p">,</span>
                   <span class="n">_objectname</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
                   <span class="n">objecttools</span><span class="o">.</span><span class="n">devicephrase</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span>

    <span class="k">return</span> <span class="nb">property</span><span class="p">(</span><span class="n">wrapper</span><span class="p">(</span><span class="n">fget</span><span class="p">),</span> <span class="n">wrapper</span><span class="p">(</span><span class="n">fset</span><span class="p">),</span> <span class="n">wrapper</span><span class="p">(</span><span class="n">fdel</span><span class="p">))</span></div>


<div class="viewcode-block" id="OptionalModuleNotAvailable"><a class="viewcode-back" href="../../../exceptiontools.html#hydpy.core.exceptiontools.OptionalModuleNotAvailable">[docs]</a><span class="k">class</span> <span class="nc">OptionalModuleNotAvailable</span><span class="p">(</span><span class="ne">ImportError</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A `HydPy` function requiring an optional module is called, but this</span>
<span class="sd">    module is not available.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="OptionalImport"><a class="viewcode-back" href="../../../exceptiontools.html#hydpy.core.exceptiontools.OptionalImport">[docs]</a><span class="k">class</span> <span class="nc">OptionalImport</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Exectutes the given import command and returns the imported module.</span>
<span class="sd">    If importomg is not possible, it returns a dummy object which raises</span>
<span class="sd">    a |OptionalModuleNotAvailable| each time a one tries to access a</span>
<span class="sd">    member of the orignal module.</span>

<span class="sd">    If the module is availabe:</span>

<span class="sd">    &gt;&gt;&gt; from hydpy.core.exceptiontools import OptionalImport</span>
<span class="sd">    &gt;&gt;&gt; numpy = OptionalImport(&#39;import numpy&#39;)</span>
<span class="sd">    &gt;&gt;&gt; numpy.nan</span>
<span class="sd">    nan</span>

<span class="sd">    If the module is not available:</span>

<span class="sd">    &gt;&gt;&gt; numpie = OptionalImport(&#39;import numpie&#39;)</span>
<span class="sd">    &gt;&gt;&gt; numpie.nan</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    OptionalModuleNotAvailable: HydPy could not load module `numpie`.  \</span>
<span class="sd">This module is no general requirement but necessary for some \</span>
<span class="sd">specific functionalities.</span>

<span class="sd">    If the module is available, but HydPy had been bundled to an</span>
<span class="sd">    executable:</span>

<span class="sd">    &gt;&gt;&gt; from hydpy import pub</span>
<span class="sd">    &gt;&gt;&gt; pub._is_hydpy_bundled = True</span>
<span class="sd">    &gt;&gt;&gt; os = OptionalImport(&#39;import os&#39;)</span>
<span class="sd">    &gt;&gt;&gt; os.getcwd()</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">    ...</span>
<span class="sd">    OptionalModuleNotAvailable: HydPy could not load module `os`.  \</span>
<span class="sd">This module is no general requirement but necessary for some \</span>
<span class="sd">specific functionalities.</span>

<span class="sd">    The latter can be prevented by passing a `True` `bundle_module`</span>
<span class="sd">    argument:</span>

<span class="sd">    &gt;&gt;&gt; textwrap = OptionalImport(&#39;import textwrap&#39;, bundle_module=True)</span>
<span class="sd">    &gt;&gt;&gt; textwrap.wrap(&#39;&#39;)</span>
<span class="sd">    []</span>

<span class="sd">    &gt;&gt;&gt; pub._is_hydpy_bundled = False</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">command</span><span class="p">,</span> <span class="n">bundle_module</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">pub</span><span class="o">.</span><span class="n">_is_hydpy_bundled</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">bundle_module</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">()</span>
            <span class="n">exec</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">eval</span><span class="p">(</span><span class="n">command</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">command</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">OptionalModuleNotAvailable</span><span class="p">(</span>
            <span class="s1">&#39;HydPy could not load module `</span><span class="si">%s</span><span class="s1">`.  This module is no &#39;</span>
            <span class="s1">&#39;general requirement but necessary for some specific &#39;</span>
            <span class="s1">&#39;functionalities.&#39;</span>
            <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span></div>


<span class="n">autodoctools</span><span class="o">.</span><span class="n">autodoc_module</span><span class="p">()</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../../index.html">Table Of Contents</a></h3>
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../framework.html">Framework Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modelcollection.html">Model Collection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../development.html">Development</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">HydPy 2.1-dev documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, Christoph Tyralla.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.5.
    </div>
  </body>
</html>